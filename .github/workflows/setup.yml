name: Reusable Setup

on:
  workflow_call: # Makes this a reusable workflow

jobs:
  setup:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: "3.x"
          channel: "stable"
          cache: true

      # - name: Cache Pub Dependencies
      #   uses: actions/cache@v3
      #   with:
      #     path: |
      #       ${{ env.PUB_CACHE }}
      #       **/.dart_tool
      #       **/.flutter-plugins
      #       **/.flutter-plugins-dependencies
      #     key: ${{ runner.os }}-pub-${{ hashFiles('**/pubspec.lock') }}
      #     restore-keys: |
      #       ${{ runner.os }}-pub-

      - name: Install Melos
        run: |
          dart pub global activate melos
          echo "$HOME/.pub-cache/bin" >> $GITHUB_PATH
          echo "PATH after adding melos: $PATH"

      - name: Verify Melos Installation
        run: which melos && melos --version

      - name: Bootstrap Melos
        run: melos bootstrap --no-private
